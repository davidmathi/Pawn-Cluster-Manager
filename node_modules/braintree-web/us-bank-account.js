!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.braintree||(t.braintree={})).usBankAccount=e()}}(function(){return function e(t,n,o){function r(a,c){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){"use strict";var o=e("./lib/error");t.exports={CALLBACK_REQUIRED:{type:o.types.MERCHANT,code:"CALLBACK_REQUIRED"},INSTANTIATION_OPTION_REQUIRED:{type:o.types.MERCHANT,code:"INSTANTIATION_OPTION_REQUIRED"},INCOMPATIBLE_VERSIONS:{type:o.types.MERCHANT,code:"INCOMPATIBLE_VERSIONS"},METHOD_CALLED_AFTER_TEARDOWN:{type:o.types.MERCHANT,code:"METHOD_CALLED_AFTER_TEARDOWN"},BRAINTREE_API_ACCESS_RESTRICTED:{type:o.types.MERCHANT,code:"BRAINTREE_API_ACCESS_RESTRICTED",message:"Your access is restricted and cannot use this part of the Braintree API."}}},{"./lib/error":5}],2:[function(e,t,n){"use strict";function o(e){return e.replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1_$2").toLowerCase()}t.exports=function(e){return Object.keys(e).reduce(function(t,n){var r=o(n);return t[r]=e[n],t},{})}},{}],3:[function(e,t,n){"use strict";t.exports=function(e){return function(){var t=arguments;setTimeout(function(){e.apply(null,t)},1)}}},{}],4:[function(e,t,n){"use strict";function o(e,t){return t=null==t?"":t,e.reduce(function(e,n){return e[n]=t+n,e},{})}t.exports=o},{}],5:[function(e,t,n){"use strict";function o(e){if(!o.types.hasOwnProperty(e.type))throw new Error(e.type+" is not a valid type.");if(!e.code)throw new Error("Error code required.");if(!e.message)throw new Error("Error message required.");this.name="BraintreeError",this.code=e.code,this.message=e.message,this.type=e.type,this.details=e.details}var r=e("./enumerate");o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.types=r(["CUSTOMER","MERCHANT","NETWORK","INTERNAL","UNKNOWN"]),t.exports=o},{"./enumerate":4}],6:[function(e,t,n){"use strict";function o(e){var t=!1;return function(){t||(t=!0,e.apply(null,arguments))}}t.exports=o},{}],7:[function(e,t,n){"use strict";var o=e("./error"),r=e("../errors");t.exports=function(e,t){if("function"!=typeof e)throw new o({type:r.CALLBACK_REQUIRED.type,code:r.CALLBACK_REQUIRED.code,message:t+" must include a callback function."})}},{"../errors":1,"./error":5}],8:[function(e,t,n){"use strict";t.exports={REQUIRED_BANK_DETAILS:["routingNumber","accountNumber","accountType","accountHolderName","billingAddress"],PLAID_LINK_JS:"https://cdn.plaid.com/link/stable/link-initialize.js"}},{}],9:[function(e,t,n){"use strict";var o=e("../lib/error");t.exports={US_BANK_OPTION_REQUIRED:{type:o.types.MERCHANT,code:"US_BANK_OPTION_REQUIRED"},US_BANK_MUTUALLY_EXCLUSIVE_OPTIONS:{type:o.types.MERCHANT,code:"US_BANK_MUTUALLY_EXCLUSIVE_OPTIONS"},US_BANK_LOGIN_LOAD_FAILED:{type:o.types.NETWORK,code:"US_BANK_LOGIN_LOAD_FAILED",message:"Bank login flow failed to load."}}},{"../lib/error":5}],10:[function(e,t,n){"use strict";function o(e,t){var n,o;return c(t,"create"),t=a(t),null==e.client?void t(new r({type:u.INSTANTIATION_OPTION_REQUIRED.type,code:u.INSTANTIATION_OPTION_REQUIRED.code,message:"options.client is required when instantiating US Bank Account."})):(n=e.client.getConfiguration().analyticsMetadata.sdkVersion,n!==s?void t(new r({type:u.INCOMPATIBLE_VERSIONS.type,code:u.INCOMPATIBLE_VERSIONS.code,message:"Client (version "+n+") and US Bank Account (version "+s+") components must be from the same SDK version."})):(o=e.client.getConfiguration().gatewayConfiguration.braintreeApi)?void t(null,new i(e)):void t(new r(u.BRAINTREE_API_ACCESS_RESTRICTED)))}var r=e("../lib/error"),i=e("./us-bank-account"),a=e("../lib/deferred"),c=e("../lib/throw-if-no-callback"),s="3.5.0",u=e("../errors");t.exports={create:o,VERSION:s}},{"../errors":1,"../lib/deferred":3,"../lib/error":5,"../lib/throw-if-no-callback":7,"./us-bank-account":11}],11:[function(e,t,n){(function(n){"use strict";function o(e){this._client=e.client}function r(e){return{nonce:e.data.id,details:{},description:e.data.description,type:e.data.type}}function i(e){e.onerror=e.onload=e.onreadystatechange=null}var a=e("../lib/error"),c=e("./constants"),s=e("./errors"),u=e("../lib/deferred"),d=e("../lib/once"),l=e("../lib/throw-if-no-callback"),_=e("../lib/camel-case-to-snake-case");o.prototype.tokenize=function(e,t){return l(t,"tokenize"),e=e||{},t=u(t),e.mandateText?void(e.bankDetails&&e.bankLogin?t(new a({type:s.US_BANK_MUTUALLY_EXCLUSIVE_OPTIONS.type,code:s.US_BANK_MUTUALLY_EXCLUSIVE_OPTIONS.code,message:"tokenize must be called with bankDetails or bankLogin, not both."})):e.bankDetails?this._tokenizeBankDetails(e,t):e.bankLogin?this._tokenizeBankLogin(e,t):t(new a({type:s.US_BANK_OPTION_REQUIRED.type,code:s.US_BANK_OPTION_REQUIRED.code,message:"tokenize must be called with bankDetails or bankLogin."}))):void t(new a({type:s.US_BANK_OPTION_REQUIRED.type,code:s.US_BANK_OPTION_REQUIRED.code,message:"mandateText property is required."}))},o.prototype._tokenizeBankDetails=function(e,t){var n,o,i=e.bankDetails,u=this._client.getConfiguration().gatewayConfiguration.braintreeApi;for(n=0;n<c.REQUIRED_BANK_DETAILS.length;n++)if(o=c.REQUIRED_BANK_DETAILS[n],!i[o])return void t(new a({type:s.US_BANK_OPTION_REQUIRED.type,code:s.US_BANK_OPTION_REQUIRED.code,message:"bankDetails."+o+" property is required."}));this._client._request({method:"POST",url:u.url+"/tokens",headers:{Authorization:"Bearer "+u.accessToken,"Braintree-Version":"2016-08-25"},data:{type:"us_bank_account",routing_number:i.routingNumber,account_number:i.accountNumber,account_holder_name:i.accountHolderName,account_type:i.accountType,billing_address:_(i.billingAddress),ach_mandate:{text:e.mandateText}}},function(e,n){return e?void t(e):void t(null,r(n))})},o.prototype._tokenizeBankLogin=function(e,t){var n=this._client,o=this._client.getConfiguration().gatewayConfiguration.braintreeApi;return e.bankLogin.displayName?void this._loadPlaid(function(i,a){return i?void t(i):void a.create({env:"tartan",clientName:e.bankLogin.displayName,key:"test_key",product:"auth",selectAccount:!0,onExit:function(){t(new Error("Customer closed bank login flow."))},onSuccess:function(i,a){n._request({method:"POST",url:o.url+"/tokens",headers:{Authorization:"Bearer "+o.accessToken,"Braintree-Version":"2016-08-25"},data:{type:"plaid_public_token",public_token:i,account_id:a.account_id,ach_mandate:{text:e.mandateText}}},function(e,n){return e?void t(e):void t(null,r(n))})}}).open()}):void t(new a({type:s.US_BANK_OPTION_REQUIRED.type,code:s.US_BANK_OPTION_REQUIRED.code,message:"displayName property is required when using bankLogin."}))},o.prototype._loadPlaid=function(e){var t;return e=d(e),n.Plaid?void e(null,n.Plaid):(t=document.createElement("script"),t.src=c.PLAID_LINK_JS,t.async=!0,t.onerror=function(){i(t),e(new a(s.US_BANK_LOGIN_LOAD_FAILED))},t.onload=t.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(i(t),e(null,n.Plaid))},document.body.appendChild(t),void(this._plaidScript=t))},o.prototype.teardown=function(){this._plaidScript&&document.body.removeChild(this._plaidScript)},t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/camel-case-to-snake-case":2,"../lib/deferred":3,"../lib/error":5,"../lib/once":6,"../lib/throw-if-no-callback":7,"./constants":8,"./errors":9}]},{},[10])(10)});
